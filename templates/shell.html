<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>MiniCloud - Shell</title>
  <style>
    body { font-family: monospace; background: #1e1e1e; color: #00ff00; margin: 0; padding: 10px }
    .container { max-width: 100%; height: 100vh; display: flex; flex-direction: column }
    .header { margin-bottom: 10px; padding: 10px; background: #2d2d2d; border-radius: 4px }
    h1 { margin: 0; color: #00ff00 }
    .back { color: #00ffff; text-decoration: none; margin-top: 5px; display: inline-block }
    .terminal { flex: 1; display: flex; flex-direction: column }
    .output { flex: 1; overflow-y: auto; background: #000; padding: 10px; border: 1px solid #333; border-radius: 4px; margin-bottom: 10px; font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word }
    .form-group { display: flex; gap: 10px }
    input { flex: 1; padding: 8px; background: #222; color: #00ff00; border: 1px solid #333; border-radius: 4px; font-family: monospace }
    button { padding: 8px 12px; background: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: monospace }
    button:hover { background: #0052a3 }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Shell: {{ name }} @ {{ server }}</h1>
      <a href="/" class="back">‚Üê Back to Dashboard</a>
    </div>

    <div class="terminal">
      <div class="output" id="output"></div>
      <form method="post" action="/shell-input" class="form-group">
        <input type="text" name="command" placeholder="Type command (or 'exit')" autofocus autocomplete="off">
        <button type="submit">Send</button>
      </form>
    </div>
  </div>

  <script>
    let lastOutput = '';
    
    function cleanANSI(text) {
      // Remove ANSI escape sequences
      return text.replace(/\x1b\[[0-9;]*[a-zA-Z]/g, '').replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g, '');
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Auto-refresh shell output every 300ms
    setInterval(function() {
      fetch('/shell-output')
        .then(r => r.text())
        .then(text => {
          const outputDiv = document.getElementById('output');
          const cleaned = cleanANSI(text);
          if (cleaned !== lastOutput) {
            lastOutput = cleaned;
            outputDiv.textContent = cleaned;
            outputDiv.scrollTop = outputDiv.scrollHeight;
          }
        })
        .catch(err => console.error('Error fetching output:', err));
    }, 300);
  </script>
</body>
</html>
